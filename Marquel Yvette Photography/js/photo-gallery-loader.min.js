!function(){"use strict";let e=null,t=!1;const o=new Map;fetch("config/photos.json?v="+Date.now()).then(e=>e.json()).then(n=>{console.log("Loading photo gallery from config..."),e=n;const a=document.querySelector(".photo-grid");if(!a)return void console.error("Photo grid container not found");a.innerHTML="";let l=0;["homepage","headshots","ratesPage","workplaceHeadshotsPage","erasHeadshotsPage","locationPages","portfolioExtras"].forEach(s=>{const c=n[s];if(!c)return;const i=function(e,t){const o=document.createElement("div");o.className="page-section-header";const n=document.createElement("h2");if(n.className="page-section-title",n.textContent=e,o.appendChild(n),t){const e=document.createElement("p");e.className="page-section-description",e.textContent=t,o.appendChild(e)}return o}(c._pageName||s,c._description);a.appendChild(i);const r=function(e,t){const o=[];function n(t,a,l){t&&"object"==typeof t&&(t.src&&"string"==typeof t.src?o.push({pageName:e,path:a,section:l,src:t.src,alt:t.alt||"",usedOn:t.usedOn||null}):Object.entries(t).forEach(([e,t])=>{if(e.startsWith("_"))return;let o=l;t&&t._section?o=t._section:l||(o=e);n(t,a?`${a}.${e}`:e,o)}))}return n(t,"",null),o}(s,c);if(r.length>0){const n=document.createElement("div");n.className="page-photo-grid",r.forEach(a=>{const s=function(n){const a=document.createElement("div");a.className="photo-item",a.dataset.page=n.pageName,a.dataset.path=n.path;const l=document.createElement("div");l.className="photo-container";const s=document.createElement("img");s.src=n.src,s.alt=n.alt,s.loading="lazy",s.onerror=function(){this.style.background="#333",this.style.minHeight="150px",this.alt="Image not found: "+n.src};const c=document.createElement("div");c.className="photo-overlay";const i=document.createElement("p");i.className="photo-section",i.textContent=n.section||n.path;const r=document.createElement("p");if(r.className="photo-path",r.textContent=n.src,n.usedOn){const e=document.createElement("p");e.className="photo-used-on",e.textContent="Used on: "+n.usedOn,c.appendChild(e)}c.appendChild(i),c.appendChild(r),l.appendChild(s),l.appendChild(c);const d=document.createElement("button");return d.className="update-photo-btn",d.textContent="Update Photo",d.onclick=()=>function(n,a,l){const s=document.createElement("input");s.type="file",s.accept="image/*",s.className="file-input",s.onchange=async s=>{const c=s.target.files[0];if(!c)return;if(!c.type.startsWith("image/"))return void alert("Please select an image file");let i="images/portfolio/";a.src.includes("banner-gallery")?i="images/banner-gallery/":a.src.includes("testimonials")?i="images/testimonials/":a.src.includes("logos")?i="images/logos/":a.src.includes("backgrounds")&&(i="images/backgrounds/");const r=new FormData;r.append("photo",c),r.append("pageName",a.pageName),r.append("path",a.path),r.append("folder",i);try{n.style.opacity="0.6";const s=await fetch("http://localhost:3000/api/upload-photo",{method:"POST",body:r}),i=await s.json();if(i.success){const s=new FileReader;s.onload=e=>{l.src=e.target.result},s.readAsDataURL(c),function(t,o,n,a){const l=o.split(".");let s=e[t];for(let e=0;e<l.length-1;e++){if(!s||!s[l[e]])return!1;s=s[l[e]]}const c=l[l.length-1];if(s&&s[c])return s[c][n]=a,!0}(a.pageName,a.path,"src",i.path),o.set(`${a.pageName}.${a.path}`,{oldPath:i.oldPath,newPath:i.path,file:c}),n.classList.add("updated"),n.style.opacity="1",t=!0,document.getElementById("deployBtn").classList.add("active"),document.getElementById("uploadInstructions").classList.add("active"),console.log("✓ Photo uploaded and saved!"),console.log(`  Page: ${a.pageName}`),console.log(`  Path: ${a.path}`),console.log(`  Old: ${i.oldPath}`),console.log(`  New: ${i.path}`)}else alert("Upload failed: "+i.error),n.style.opacity="1"}catch(e){console.error("Upload error:",e),alert("Upload failed. Make sure the photo gallery server is running on port 3000."),n.style.opacity="1"}},s.click()}(a,n,s),a.appendChild(l),a.appendChild(d),a}(a);n.appendChild(s),l++}),a.appendChild(n)}}),console.log(`✓ Photo gallery loaded with ${l} photos`),function(){const e=document.getElementById("deployBtn");e.onclick=async()=>{if(t){if(confirm("Deploy all changes to CloudFront? This will update your live website.")){e.disabled=!0,e.textContent="Deploying...",e.style.opacity="0.6";try{const t=Array.from(o.values()).map(e=>e.newPath),n=await fetch("http://localhost:3000/api/deploy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({updatedFiles:t})}),a=await n.json();a.success?(alert(`✅ Successfully deployed to CloudFront!\n\nInvalidation ID: ${a.invalidationId}\n\nYour live website will update in 1-2 minutes.`),e.textContent="Deployed ✓",e.style.background="#4CAF50",console.log("✓ Deployment complete!"),console.log(`  Invalidation ID: ${a.invalidationId}`),console.log("  Updated files:",t)):(alert("Deployment failed: "+a.error),e.disabled=!1,e.textContent="Deploy to CloudFront",e.style.opacity="1")}catch(t){console.error("Deploy error:",t),alert("Deployment failed. Make sure the photo gallery server is running and AWS CLI is configured."),e.disabled=!1,e.textContent="Deploy to CloudFront",e.style.opacity="1"}}}else alert("No updates to deploy")}}()}).catch(e=>{console.error("Error loading photo gallery:",e)})}();